<!doctype html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (AomKunMai)</title>
    <script src="/_sdk/element_sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@200;300;400;500;600;700&amp;display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ... existing CSS styles ... */
        body {
            box-sizing: border-box;
            font-family: 'Mitr', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
        }

        html,
        body {
            height: 100%;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100% - 80px);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #667eea;
            margin: 0 0 10px 0;
            font-size: 2.5rem;
            font-weight: 600;
        }

        .header p {
            color: #666;
            margin: 0;
            font-size: 1.1rem;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'Mitr', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .nav-tab:hover:not(.active) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #667eea;
            margin: 0 0 20px 0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card.income {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .stat-card.expense {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .stat-card .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Mitr', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-family: 'Mitr', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .profile-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .profile-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .profile-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .profile-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .profile-item h3 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
        }

        .profile-item p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .transaction-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .transaction-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .transaction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .transaction-item.income {
            border-left-color: #38ef7d;
        }

        .transaction-item.expense {
            border-left-color: #ff6b6b;
        }

        .transaction-item.active {
            background: #e3e7f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-info h4 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            color: #333;
        }

        .transaction-info p {
            margin: 0;
            font-size: 0.85rem;
            color: #666;
        }

        .transaction-amount {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .transaction-amount.income {
            color: #38ef7d;
        }

        .transaction-amount.expense {
            color: #ff6b6b;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.show {
            display: flex;
        }

        .toast.success {
            border-left: 4px solid #4caf50;
        }

        .toast.error {
            border-left: 4px solid #f44336;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 0.9rem;
        }

        .theme-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .theme-option {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .theme-option:hover {
            transform: scale(1.05);
        }

        .theme-option.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .theme-light {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .theme-dark {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
        }

        .theme-green {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .limit-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .limit-warning.show {
            display: block;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .radio-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .radio-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .category-option {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .category-option:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .category-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .user-selector {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .user-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-family: 'Mitr', sans-serif;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .knowledge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .knowledge-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .knowledge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .knowledge-card h3 {
            color: #333;
            margin: 15px 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .knowledge-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .knowledge-icon i {
            font-size: 1.8rem;
            color: white;
        }

        .knowledge-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }

        .knowledge-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
            line-height: 1.6;
        }

        .knowledge-list li:last-child {
            border-bottom: none;
        }

        .knowledge-list ol {
            counter-reset: item;
            list-style: none;
            padding: 0;
        }

        .knowledge-card ol.knowledge-list {
            counter-reset: step;
        }

        .knowledge-card ol.knowledge-list li {
            counter-increment: step;
            position: relative;
            padding-left: 35px;
        }

        .knowledge-card ol.knowledge-list li:before {
            content: counter(step);
            position: absolute;
            left: 0;
            top: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .budget-visualization {
            margin: 20px 0;
        }

        .budget-bar {
            display: flex;
            height: 50px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .budget-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .budget-segment.needs {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex: 5;
        }

        .budget-segment.wants {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            flex: 3;
        }

        .budget-segment.savings {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            flex: 2;
        }

        .compound-demo {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .year-card {
            flex: 1;
            min-width: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            color: white;
        }

        .year-card .year {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .year-card .amount {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .warning-list li {
            color: #d32f2f;
        }

        .warning-list li i {
            margin-right: 8px;
        }

        .age-timeline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .age-stage {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .age-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .age-stage ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .age-stage ul li {
            padding: 5px 0;
            font-size: 0.9rem;
            color: #666;
        }

        .age-stage ul li:before {
            content: "‚úì";
            color: #38ef7d;
            margin-right: 8px;
            font-weight: 600;
        }

        .investment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .invest-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .invest-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .invest-item h4 {
            margin: 10px 0;
            font-size: 1rem;
            color: #333;
        }

        .invest-item p {
            font-size: 0.85rem;
            color: #666;
            margin: 8px 0;
            line-height: 1.5;
        }

        .risk-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .risk-badge.medium {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .risk-badge.high {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        @media (max-width: 768px) {
            .knowledge-grid {
                grid-template-columns: 1fr;
            }

            .compound-demo {
                flex-direction: column;
            }

            .age-timeline {
                grid-template-columns: 1fr;
            }

            .investment-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <style>
        @view-transition {
            navigation: auto;
        }
    </style>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1 id="pageTitle">üí∞ aomkunmai</h1>
            <p id="welcomeMessage">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢ (‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)</p>
        </header>
        <div class="nav-tabs"><button class="nav-tab active" data-tab="profile"> <i class="fas fa-user"></i>
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå </button> <button class="nav-tab" data-tab="transactions"> <i class="fas fa-wallet"></i>
                ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ </button> <button class="nav-tab" data-tab="knowledge"> <i
                    class="fas fa-graduation-cap"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô </button>
        </div><!-- Profile Tab -->
        <div class="tab-content active" id="profileTab">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="number" id="totalProfiles">
                        0
                    </div>
                    <div class="label">
                        ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </div>
                </div>
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="number" id="activeUsers">
                        0
                    </div>
                    <div class="label">
                        ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </div>
                </div>
            </div>
            <div class="main-content">
                <div class="card">
                    <h2><i class="fas fa-users"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
                    <div class="limit-warning" id="profileLimitWarning"><i class="fas fa-exclamation-triangle"></i>
                        ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß
                    </div><button class="btn" id="newProfileBtn"> <i class="fas fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà </button>
                    <div class="profile-list" id="profileList">
                        <div class="empty-state">
                            <span class="loading"
                                style="border-color: #667eea; border-top-color: transparent; width: 30px; height: 30px;"></span>
                            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h2 id="profileFormTitle"><i class="fas fa-user-edit"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="profileForm">
                        <div class="form-group"><label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ <span
                                    style="color: red;">*</span></label> <input type="text" id="username"
                                name="username" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
                        </div>
                        <div class="form-group"><label for="fullName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text"
                                id="fullName" name="fullName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                        </div>
                        <div class="form-group"><label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="email"
                                name="email" placeholder="example@email.com">
                        </div>
                        <div class="form-group"><label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label> <input type="tel" id="phone"
                                name="phone" placeholder="08X-XXX-XXXX">
                        </div>
                        <div class="form-group"><label for="bio">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</label> <textarea id="bio" name="bio"
                                placeholder="‡∏ö‡∏≠‡∏Å‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì..."></textarea>
                        </div>
                        <div class="form-group"><label>‡∏ò‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
                            <div class="theme-preview">
                                <div class="theme-option theme-light selected" data-theme="light"><i
                                        class="fas fa-sun"></i>
                                    <p>‡∏™‡∏ß‡πà‡∏≤‡∏á</p>
                                </div>
                                <div class="theme-option theme-dark" data-theme="dark"><i class="fas fa-moon"></i>
                                    <p>‡∏°‡∏∑‡∏î</p>
                                </div>
                                <div class="theme-option theme-green" data-theme="green"><i class="fas fa-leaf"></i>
                                    <p>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</p>
                                </div>
                            </div><input type="hidden" id="theme" name="theme" value="light">
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group"><input type="checkbox" id="notifications" name="notifications"
                                    checked> <label for="notifications">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                            </div>
                        </div>
                        <div class="btn-group"><button type="submit" class="btn" id="profileSubmitBtn"> <i
                                    class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å </button> <button type="button"
                                class="btn btn-secondary" id="profileCancelBtn" style="display: none;"> <i
                                    class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button type="button"
                                class="btn btn-danger" id="profileDeleteBtn" style="display: none;"> <i
                                    class="fas fa-trash"></i> ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå </button>
                        </div>
                    </form>
                </div>
            </div>
        </div><!-- Transactions Tab -->
        <div class="tab-content" id="transactionsTab">
            <div class="user-selector" id="userSelectorSection" style="display: none;"><label><i
                        class="fas fa-user"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label> <select id="userSelector">
                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ --</option>
                </select>
            </div>
            <div class="stats-grid" id="transactionStats" style="display: none;">
                <div class="stat-card income">
                    <div class="icon">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="number" id="totalIncome">
                        0
                    </div>
                    <div class="label">
                        ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)
                    </div>
                </div>
                <div class="stat-card expense">
                    <div class="icon">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                    <div class="number" id="totalExpense">
                        0
                    </div>
                    <div class="label">
                        ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)
                    </div>
                </div>
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="number" id="balance">
                        0
                    </div>
                    <div class="label">
                        ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ö‡∏≤‡∏ó)
                    </div>
                </div>
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-list"></i>
                    </div>
                    <div class="number" id="totalTransactions">
                        0
                    </div>
                    <div class="label">
                        ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </div>
                </div>
            </div>
            <div class="main-content" id="transactionContent" style="display: none;">
                <div class="card">
                    <h2><i class="fas fa-list"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                    <div class="limit-warning" id="transactionLimitWarning"><i class="fas fa-exclamation-triangle"></i>
                        ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß
                    </div><button class="btn btn-success" id="newTransactionBtn"> <i class="fas fa-plus"></i>
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà </button>
                    <div class="transaction-list" id="transactionList">
                        <div class="empty-state"><i class="fas fa-receipt"></i>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h2 id="transactionFormTitle"><i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="transactionForm">
                        <div class="form-group"><label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó <span style="color: red;">*</span></label>
                            <div class="radio-group">
                                <div class="radio-option selected" data-type="income"><input type="radio"
                                        name="transactionType" value="income" checked> <i class="fas fa-arrow-up"
                                        style="font-size: 1.5rem;"></i>
                                    <p style="margin: 5px 0 0 0;">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</p>
                                </div>
                                <div class="radio-option" data-type="expense"><input type="radio" name="transactionType"
                                        value="expense"> <i class="fas fa-arrow-down" style="font-size: 1.5rem;"></i>
                                    <p style="margin: 5px 0 0 0;">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</p>
                                </div>
                            </div>
                        </div>
                        <div class="form-group"><label for="amount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó) <span
                                    style="color: red;">*</span></label> <input type="number" id="amount" name="amount"
                                placeholder="0.00" step="0.01" min="0" required>
                        </div>
                        <div class="form-group"><label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà <span style="color: red;">*</span></label>
                            <div class="category-grid" id="categoryGrid">
                                <!-- Categories will be populated by JavaScript -->
                            </div><input type="hidden" id="category" name="category" value="">
                        </div>
                        <div class="form-group"><label for="description">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label> <textarea id="description"
                                name="description" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
                        </div>
                        <div class="form-group"><label for="transactionDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span
                                    style="color: red;">*</span></label> <input type="date" id="transactionDate"
                                name="transactionDate" required>
                        </div>
                        <div class="btn-group"><button type="submit" class="btn" id="transactionSubmitBtn"> <i
                                    class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å </button> <button type="button"
                                class="btn btn-secondary" id="transactionCancelBtn" style="display: none;"> <i
                                    class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button type="button"
                                class="btn btn-danger" id="transactionDeleteBtn" style="display: none;"> <i
                                    class="fas fa-trash"></i> ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ </button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="empty-state" id="noUserSelected"><i class="fas fa-user-circle"></i>
                <h3>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô</h3>
                <p>‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏î‡πâ</p><button class="btn"
                    onclick="switchTab('profile')"> <i class="fas fa-user-plus"></i> ‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå </button>
            </div>
        </div><!-- Knowledge Tab -->
        <!-- ... existing code ... -->
        <div class="tab-content" id="knowledgeTab">
            <div class="card">
                <h2><i class="fas fa-graduation-cap"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h2>
                <p style="color: #666; margin-bottom: 30px;">‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏Ñ‡∏ß‡∏£‡∏£‡∏π‡πâ ‡∏à‡∏≤‡∏Å SET Investnow
                </p>
                <div class="knowledge-grid">
                    <div class="knowledge-card">
                        <div class="knowledge-icon"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><i
                                class="fas fa-piggy-bank"></i>
                        </div>
                        <h3>‡∏´‡∏•‡∏±‡∏Å 6 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h3>
                        <ol class="knowledge-list">
                            <li><strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</strong> - ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô
                            </li>
                            <li><strong>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</strong> - ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏•‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏ß</li>
                            <li><strong>‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</strong> - ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</li>
                            <li><strong>‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</strong> - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</li>
                            <li><strong>‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô</strong> - ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢</li>
                            <li><strong>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô</strong> - ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå</li>
                        </ol>
                    </div>
                    <div class="knowledge-card">
                        <div class="knowledge-icon"
                            style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);"><i
                                class="fas fa-chart-pie"></i>
                        </div>
                        <h3>‡∏´‡∏•‡∏±‡∏Å 50/30/20 ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô</h3>
                        <div class="budget-visualization">
                            <div class="budget-bar">
                                <div class="budget-segment needs">
                                    50%
                                </div>
                                <div class="budget-segment wants">
                                    30%
                                </div>
                                <div class="budget-segment savings">
                                    20%
                                </div>
                            </div>
                        </div>
                        <ul class="knowledge-list">
                            <li><strong>50% ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</strong> - ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥-‡πÑ‡∏ü</li>
                            <li><strong>30% ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</strong> - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</li>
                            <li><strong>20% ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°-‡∏•‡∏á‡∏ó‡∏∏‡∏ô</strong> - ‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏≠‡∏° ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ‡∏•‡∏á‡∏ó‡∏∏‡∏ô</li>
                        </ul>
                        <p style="font-size: 0.9rem; color: #666; margin-top: 15px;"><i class="fas fa-lightbulb"></i>
                            <em>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</em>
                        </p>
                    </div>
                    <div class="knowledge-card">
                        <div class="knowledge-icon"
                            style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><i
                                class="fas fa-shield-alt"></i>
                        </div>
                        <h3>‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (Emergency Fund)</h3>
                        <p><strong>‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?</strong></p>
                        <ul class="knowledge-list">
                            <li><strong>‡∏Ñ‡∏ô‡πÇ‡∏™‡∏î:</strong> 3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</li>
                            <li><strong>‡∏°‡∏µ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß:</strong> 6-12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</li>
                            <li><strong>‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß:</strong> 12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</li>
                        </ul>
                        <div
                            style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #ffc107;">
                            <p style="margin: 0; color: #856404;"><i class="fas fa-exclamation-triangle"></i>
                                <strong>‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!</strong> ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
                                ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÉ‡∏ô‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
                            </p>
                        </div>
                    </div>
                    <div class="knowledge-card">
                        <div class="knowledge-icon"
                            style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"><i
                                class="fas fa-calculator"></i>
                        </div>
                        <h3>‡∏Å‡∏é 72 ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 2 ‡πÄ‡∏ó‡πà‡∏≤</h3>
                        <p>‡∏™‡∏π‡∏ï‡∏£: <strong>72 √∑ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô (%) = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ</strong></p>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                            <p style="margin: 0 0 10px 0; color: #333;"><strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong></p>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #e0e0e0;"><i
                                        class="fas fa-arrow-right" style="color: #667eea;"></i> ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô 6% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ ‚Üí 72 √∑
                                    6 = <strong>12 ‡∏õ‡∏µ</strong></li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #e0e0e0;"><i
                                        class="fas fa-arrow-right" style="color: #667eea;"></i> ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô 8% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ ‚Üí 72 √∑
                                    8 = <strong>9 ‡∏õ‡∏µ</strong></li>
                                <li style="padding: 8px 0;"><i class="fas fa-arrow-right" style="color: #667eea;"></i>
                                    ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô 12% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ ‚Üí 72 √∑ 12 = <strong>6 ‡∏õ‡∏µ</strong></li>
                            </ul>
                        </div>
                    </div>
                    <div class="knowledge-card">
                        <div class="knowledge-icon"
                            style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"><i
                                class="fas fa-money-bill-wave"></i>
                        </div>
                        <h3>‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏ö‡∏ï‡πâ‡∏ô</h3>
                        <p>‡πÄ‡∏á‡∏¥‡∏ô 10,000 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô 7% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ</p>
                        <div class="compound-demo">
                            <div class="year-card">
                                <div class="year">
                                    10 ‡∏õ‡∏µ
                                </div>
                                <div class="amount">
                                    19,672 ‡∏ö‡∏≤‡∏ó
                                </div>
                            </div>
                            <div class="year-card">
                                <div class="year">
                                    20 ‡∏õ‡∏µ
                                </div>
                                <div class="amount">
                                    38,697 ‡∏ö‡∏≤‡∏ó
                                </div>
                            </div>
                            <div class="year-card">
                                <div class="year">
                                    30 ‡∏õ‡∏µ
                                </div>
                                <div class="amount">
                                    76,123 ‡∏ö‡∏≤‡∏ó
                                </div>
                            </div>
                        </div>
                        <p style="font-size: 0.9rem; color: #666; margin-top: 15px;"><i class="fas fa-chart-line"></i>
                            <strong>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡πá‡∏ß = ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏ï‡πÄ‡∏£‡πá‡∏ß!</strong> ‡∏¢‡∏¥‡πà‡∏á‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏°‡∏≤‡∏Å
                        </p>
                    </div>
                    <div class="knowledge-card">
                        <div class="knowledge-icon"
                            style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);"><i
                                class="fas fa-exclamation-circle"></i>
                        </div>
                        <h3>‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á</h3>
                        <ul class="knowledge-list warning-list">
                            <li><i class="fas fa-times-circle"></i> ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡∏ï‡∏±‡∏ß ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</li>
                            <li><i class="fas fa-times-circle"></i> ‡∏Å‡∏π‡πâ‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</li>
                            <li><i class="fas fa-times-circle"></i> ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡∏ß‡∏±‡∏ô‡πÜ</li>
                            <li><i class="fas fa-times-circle"></i> ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</li>
                            <li><i class="fas fa-times-circle"></i> ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</li>
                            <li><i class="fas fa-times-circle"></i> ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ú‡πà‡∏≠‡∏ô ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ü‡∏∏‡πà‡∏°‡πÄ‡∏ü‡∏∑‡∏≠‡∏¢</li>
                        </ul>
                    </div>
                    <div class="knowledge-card">
                        <div class="knowledge-icon"
                            style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);"><i
                                class="fas fa-heartbeat"></i>
                        </div>
                        <h3>‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</h3>
                        <div class="age-timeline">
                            <div class="age-stage">
                                <div class="age-badge">
                                    20-30 ‡∏õ‡∏µ
                                </div>
                                <ul>
                                    <li>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</li>
                                    <li>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</li>
                                    <li>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß</li>
                                </ul>
                            </div>
                            <div class="age-stage">
                                <div class="age-badge">
                                    30-40 ‡∏õ‡∏µ
                                </div>
                                <ul>
                                    <li>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</li>
                                    <li>‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</li>
                                    <li>‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</li>
                                </ul>
                            </div>
                            <div class="age-stage">
                                <div class="age-badge">
                                    40-50 ‡∏õ‡∏µ
                                </div>
                                <ul>
                                    <li>‡πÄ‡∏£‡πà‡∏á‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</li>
                                    <li>‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</li>
                                    <li>‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ö‡∏∏‡∏ï‡∏£</li>
                                </ul>
                            </div>
                            <div class="age-stage">
                                <div class="age-badge">
                                    50+ ‡∏õ‡∏µ
                                </div>
                                <ul>
                                    <li>‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</li>
                                    <li>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</li>
                                    <li>‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏°‡∏£‡∏î‡∏Å</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="knowledge-card">
                        <div class="knowledge-icon"
                            style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);"><i
                                class="fas fa-university"></i>
                        </div>
                        <h3>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
                        <div class="investment-options">
                            <div class="invest-item low-risk">
                                <div class="risk-badge">
                                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥
                                </div>
                                <h4><i class="fas fa-shield-alt"></i> ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å</h4>
                                <p>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô 0.5-2% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ<br>
                                    ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</p>
                            </div>
                            <div class="invest-item low-risk">
                                <div class="risk-badge">
                                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥
                                </div>
                                <h4><i class="fas fa-landmark"></i> ‡∏û‡∏±‡∏ô‡∏ò‡∏ö‡∏±‡∏ï‡∏£‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•</h4>
                                <p>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô 1-3% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ<br>
                                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å</p>
                            </div>
                            <div class="invest-item medium-risk">
                                <div class="risk-badge medium">
                                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
                                </div>
                                <h4><i class="fas fa-briefcase"></i> ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</h4>
                                <p>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô 3-8% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ<br>
                                    ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</p>
                            </div>
                            <div class="invest-item high-risk">
                                <div class="risk-badge high">
                                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á
                                </div>
                                <h4><i class="fas fa-chart-line"></i> ‡∏´‡∏∏‡πâ‡∏ô</h4>
                                <p>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô 5-15%+ ‡∏ï‡πà‡∏≠‡∏õ‡∏µ<br>
                                    ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-top: 30px; text-align: center;">
                    <h3 style="margin: 0 0 15px 0; font-size: 1.5rem;"><i class="fas fa-rocket"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ!
                    </h3>
                    <p style="margin: 0; font-size: 1.1rem; opacity: 0.9;">‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏Å
                        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á<br>
                        ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∏‡∏ô</p>
                    <p style="margin: 15px 0 0 0; font-size: 0.9rem; opacity: 0.8;"><i class="fas fa-info-circle"></i>
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å SET Investnow | <a href="https://www.set.or.th/th/education/investnow" target="_blank"
                            rel="noopener noreferrer" style="color: white; text-decoration: underline;">
                            ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° </a></p>
                </div>
            </div>
        </div>
        <footer class="footer" id="footerText">
            ¬© 2024 KUDSS M35 workingteam | Made with ‚ù§Ô∏è
        </footer>
    </div>
    <div class="toast" id="toast"><i class="fas fa-check-circle"></i> <span id="toastMessage">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // 1. Initialize Firebase with YOUR config
        const firebaseConfig = {
            apiKey: "AIzaSyCtHPGTSzHM9PbyYFcYJC0LypgY4UURcUc",
            authDomain: "aomkunmai-c5f80.firebaseapp.com",
            databaseURL: "https://aomkunmai-c5f80-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "aomkunmai-c5f80",
            storageBucket: "aomkunmai-c5f80.firebasestorage.app",
            messagingSenderId: "58615740840",
            appId: "1:58615740840:web:314881d2b1ee2e50ed059d",
            measurementId: "G-C5HFSXR1R1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let unsubscribeSnapshot = null;

        const defaultConfig = {
            page_title: "üí∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß",
            welcome_message: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢ (‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)",
            footer_text: "¬© 2024 ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß | Made with ‚ù§Ô∏è",
            background_color: "#667eea",
            surface_color: "#ffffff",
            text_color: "#333333",
            primary_action_color: "#667eea",
            secondary_action_color: "#764ba2",
            font_family: "Mitr",
            font_size: 16
        };

        let allData = [];
        let currentProfile = null;
        let currentTransaction = null;
        let selectedUser = null;
        let isProfileEditMode = false;
        let isTransactionEditMode = false;

        const incomeCategories = ['‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', '‡πÇ‡∏ö‡∏ô‡∏±‡∏™', '‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á', '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢', '‡∏•‡∏á‡∏ó‡∏∏‡∏ô', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'];
        const expenseCategories = ['‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á', '‡∏Ñ‡πà‡∏≤‡∏ö‡πâ‡∏≤‡∏ô', '‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á', '‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'];

        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                const profiles = data.filter(item => item.type === 'profile');
                const transactions = data.filter(item => item.type === 'transaction');

                renderProfileList(profiles);
                updateProfileStats(profiles);
                checkProfileLimit(profiles.length);

                updateUserSelector(profiles);

                if (selectedUser) {
                    const userTransactions = transactions.filter(t => t.user_id === selectedUser);
                    renderTransactionList(userTransactions);
                    updateTransactionStats(userTransactions);
                    checkTransactionLimit(transactions.length);
                }
            }
        };

        // Firestore Realtime Listener
        function setupRealtimeListener(user) {
            if (unsubscribeSnapshot) unsubscribeSnapshot();

            // Path: users/{uid}/finance_data
            const q = query(collection(db, 'users', user.uid, 'finance_data'));

            unsubscribeSnapshot = onSnapshot(q, (snapshot) => {
                const data = [];
                snapshot.forEach((doc) => {
                    data.push({ ...doc.data(), __backendId: doc.id });
                });
                dataHandler.onDataChanged(data);
            }, (error) => {
                console.error("Error fetching data: ", error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
            });
        }

        function renderProfileList(profiles) {
            const listContainer = document.getElementById('profileList');

            if (profiles.length === 0) {
                listContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-user-plus"></i>
            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</p>
          </div>
        `;
                return;
            }

            listContainer.innerHTML = profiles.map(profile => `
        <div class="profile-item ${currentProfile && currentProfile.__backendId === profile.__backendId ? 'active' : ''}" 
             data-id="${profile.__backendId}">
          <h3><i class="fas fa-user"></i> ${profile.username}</h3>
          <p>${profile.full_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</p>
          <p style="font-size: 0.8rem; opacity: 0.7;">
            <i class="fas fa-clock"></i> ${new Date(profile.updatedAt).toLocaleDateString('th-TH')}
          </p>
        </div>
      `).join('');

            document.querySelectorAll('.profile-item').forEach(item => {
                item.addEventListener('click', () => {
                    const profileId = item.dataset.id;
                    const profile = profiles.find(p => p.__backendId === profileId);
                    if (profile) {
                        loadProfile(profile);
                    }
                });
            });
        }

        function updateProfileStats(profiles) {
            document.getElementById('totalProfiles').textContent = profiles.length;
            const activeUsers = profiles.filter(p => p.notifications).length;
            document.getElementById('activeUsers').textContent = activeUsers;
        }

        function checkProfileLimit(count) {
            const warning = document.getElementById('profileLimitWarning');
            const newBtn = document.getElementById('newProfileBtn');

            if (count >= 999) {
                warning.classList.add('show');
                newBtn.disabled = true;
            } else {
                warning.classList.remove('show');
                newBtn.disabled = false;
            }
        }

        function updateUserSelector(profiles) {
            const selector = document.getElementById('userSelector');
            const selectorSection = document.getElementById('userSelectorSection');
            const noUserSelected = document.getElementById('noUserSelected');
            const transactionStats = document.getElementById('transactionStats');
            const transactionContent = document.getElementById('transactionContent');

            if (profiles.length === 0) {
                selectorSection.style.display = 'none';
                noUserSelected.style.display = 'block';
                transactionStats.style.display = 'none';
                transactionContent.style.display = 'none';
                return;
            }

            selectorSection.style.display = 'block';
            noUserSelected.style.display = 'none';

            // Keep current selection if valid
            const currentVal = selector.value;

            selector.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ --</option>' +
                profiles.map(p => `<option value="${p.id}">${p.username} ${p.full_name ? '(' + p.full_name + ')' : ''}</option>`).join('');

            if (currentVal && profiles.some(p => p.id === currentVal)) {
                selector.value = currentVal;
            } else if (selectedUser) {
                selector.value = selectedUser;
            }

            if (selector.value) {
                selectedUser = selector.value; // Ensure sync
                transactionStats.style.display = 'grid';
                transactionContent.style.display = 'block';
            } else {
                transactionStats.style.display = 'none';
                transactionContent.style.display = 'none';
            }
        }

        function renderTransactionList(transactions) {
            const listContainer = document.getElementById('transactionList');

            if (transactions.length === 0) {
                listContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-receipt"></i>
            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</p>
          </div>
        `;
                return;
            }

            const sortedTransactions = [...transactions].sort((a, b) =>
                new Date(b.date) - new Date(a.date)
            );

            listContainer.innerHTML = sortedTransactions.map(trans => `
        <div class="transaction-item ${trans.transaction_type} ${currentTransaction && currentTransaction.__backendId === trans.__backendId ? 'active' : ''}" 
             data-id="${trans.__backendId}">
          <div class="transaction-info">
            <h4>
              <i class="fas fa-tag"></i> ${trans.category}
              ${trans.transaction_type === 'income' ? '<span style="color: #38ef7d;">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>' : '<span style="color: #ff6b6b;">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>'}
            </h4>
            <p>${trans.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
            <p><i class="fas fa-calendar"></i> ${new Date(trans.date).toLocaleDateString('th-TH')}</p>
          </div>
          <div class="transaction-amount ${trans.transaction_type}">
            ${trans.transaction_type === 'income' ? '+' : '-'}${parseFloat(trans.amount).toLocaleString('th-TH', { minimumFractionDigits: 2 })}
          </div>
        </div>
      `).join('');

            document.querySelectorAll('.transaction-item').forEach(item => {
                item.addEventListener('click', () => {
                    const transId = item.dataset.id;
                    const trans = transactions.find(t => t.__backendId === transId);
                    if (trans) {
                        loadTransaction(trans);
                    }
                });
            });
        }

        function updateTransactionStats(transactions) {
            const income = transactions
                .filter(t => t.transaction_type === 'income')
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);

            const expense = transactions
                .filter(t => t.transaction_type === 'expense')
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);

            const balance = income - expense;

            document.getElementById('totalIncome').textContent = income.toLocaleString('th-TH', { minimumFractionDigits: 2 });
            document.getElementById('totalExpense').textContent = expense.toLocaleString('th-TH', { minimumFractionDigits: 2 });
            document.getElementById('balance').textContent = balance.toLocaleString('th-TH', { minimumFractionDigits: 2 });
            document.getElementById('totalTransactions').textContent = transactions.length;
        }

        function checkTransactionLimit(count) {
            const warning = document.getElementById('transactionLimitWarning');
            const newBtn = document.getElementById('newTransactionBtn');

            if (count >= 999) {
                warning.classList.add('show');
                newBtn.disabled = true;
            } else {
                warning.classList.remove('show');
                newBtn.disabled = false;
            }
        }

        function loadProfile(profile) {
            currentProfile = profile;
            isProfileEditMode = true;

            document.getElementById('username').value = profile.username || '';
            document.getElementById('fullName').value = profile.full_name || '';
            document.getElementById('email').value = profile.email || '';
            document.getElementById('phone').value = profile.phone || '';
            document.getElementById('bio').value = profile.bio || '';
            document.getElementById('theme').value = profile.theme || 'light';
            document.getElementById('notifications').checked = profile.notifications || false;

            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.theme === profile.theme) {
                    option.classList.add('selected');
                }
            });

            document.getElementById('profileFormTitle').innerHTML = '<i class="fas fa-user-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå';
            document.getElementById('profileSubmitBtn').innerHTML = '<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            document.getElementById('profileCancelBtn').style.display = 'inline-flex';
            document.getElementById('profileDeleteBtn').style.display = 'inline-flex';

            // Re-render list to show active state
            renderProfileList(allData.filter(item => item.type === 'profile'));
        }

        function loadTransaction(trans) {
            currentTransaction = trans;
            isTransactionEditMode = true;

            const transType = trans.transaction_type;
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.type === transType) {
                    option.classList.add('selected');
                    option.querySelector('input').checked = true;
                }
            });

            document.getElementById('amount').value = trans.amount;
            document.getElementById('category').value = trans.category;
            document.getElementById('description').value = trans.description || '';
            document.getElementById('transactionDate').value = trans.date;

            updateCategoryOptions(transType);
            document.querySelectorAll('.category-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.category === trans.category) {
                    option.classList.add('selected');
                }
            });

            document.getElementById('transactionFormTitle').innerHTML = '<i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
            document.getElementById('transactionSubmitBtn').innerHTML = '<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            document.getElementById('transactionCancelBtn').style.display = 'inline-flex';
            document.getElementById('transactionDeleteBtn').style.display = 'inline-flex';

            // Re-render list to show active state
            renderTransactionList(allData.filter(item => item.type === 'transaction' && item.user_id === selectedUser));
        }

        function resetProfileForm() {
            currentProfile = null;
            isProfileEditMode = false;

            document.getElementById('profileForm').reset();
            document.getElementById('theme').value = 'light';

            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.theme === 'light') {
                    option.classList.add('selected');
                }
            });

            document.getElementById('profileFormTitle').innerHTML = '<i class="fas fa-user-edit"></i> ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('profileSubmitBtn').innerHTML = '<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            document.getElementById('profileCancelBtn').style.display = 'none';
            document.getElementById('profileDeleteBtn').style.display = 'none';

            renderProfileList(allData.filter(item => item.type === 'profile'));
        }

        function resetTransactionForm() {
            currentTransaction = null;
            isTransactionEditMode = false;

            document.getElementById('transactionForm').reset();
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector('.radio-option[data-type="income"]').classList.add('selected');

            updateCategoryOptions('income');

            document.getElementById('transactionFormTitle').innerHTML = '<i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('transactionSubmitBtn').innerHTML = '<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            document.getElementById('transactionCancelBtn').style.display = 'none';
            document.getElementById('transactionDeleteBtn').style.display = 'none';

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;

            if (selectedUser) {
                renderTransactionList(allData.filter(item => item.type === 'transaction' && item.user_id === selectedUser));
            }
        }

        function updateCategoryOptions(type) {
            const categories = type === 'income' ? incomeCategories : expenseCategories;
            const grid = document.getElementById('categoryGrid');

            grid.innerHTML = categories.map(cat => `
        <div class="category-option" data-category="${cat}">
          ${cat}
        </div>
      `).join('');

            document.querySelectorAll('.category-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.category-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    option.classList.add('selected');
                    document.getElementById('category').value = option.dataset.category;
                });
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const icon = toast.querySelector('i');

            toastMessage.textContent = message;
            toast.className = `toast ${type} show`;

            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else {
                icon.className = 'fas fa-exclamation-circle';
            }

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });

        document.getElementById('newProfileBtn').addEventListener('click', () => {
            resetProfileForm();
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        });

        document.getElementById('profileCancelBtn').addEventListener('click', () => {
            resetProfileForm();
        });

        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.theme-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                option.classList.add('selected');
                document.getElementById('theme').value = option.dataset.theme;
            });
        });

        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!currentUser) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            const submitBtn = document.getElementById('profileSubmitBtn');
            const originalContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const formData = {
                type: 'profile',
                username: document.getElementById('username').value.trim(),
                full_name: document.getElementById('fullName').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                bio: document.getElementById('bio').value.trim(),
                theme: document.getElementById('theme').value,
                notifications: document.getElementById('notifications').checked,
                updatedAt: new Date().toISOString()
            };

            if (!formData.username) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalContent;
                return;
            }

            try {
                const collectionRef = collection(db, 'users', currentUser.uid, 'finance_data');

                if (isProfileEditMode && currentProfile) {
                    const updatedProfile = {
                        ...currentProfile,
                        ...formData
                    };

                    // Remove __backendId from data to be saved
                    const { __backendId, ...dataToSave } = updatedProfile;

                    await updateDoc(doc(db, 'users', currentUser.uid, 'finance_data', __backendId), dataToSave);
                    showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    resetProfileForm();

                } else {
                    const profiles = allData.filter(item => item.type === 'profile');
                    if (profiles.length >= 999) {
                        showToast('‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß', 'error');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalContent;
                        return;
                    }

                    const newProfile = {
                        id: generateId(), // Internal ID for linking
                        ...formData,
                        createdAt: new Date().toISOString()
                    };

                    await addDoc(collectionRef, newProfile);
                    showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    resetProfileForm();
                }
            } catch (error) {
                console.error(error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            }

            submitBtn.disabled = false;
            submitBtn.innerHTML = originalContent;
        });

        document.getElementById('profileDeleteBtn').addEventListener('click', async () => {
            if (!currentProfile || !currentUser) return;

            const deleteBtn = document.getElementById('profileDeleteBtn');
            const originalContent = deleteBtn.innerHTML;

            if (deleteBtn.dataset.confirmDelete === 'true') {
                deleteBtn.disabled = true;
                deleteBtn.innerHTML = '<span class="loading"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...';

                try {
                    await deleteDoc(doc(db, 'users', currentUser.uid, 'finance_data', currentProfile.__backendId));

                    showToast('‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    resetProfileForm();

                    if (selectedUser === currentProfile.id) {
                        selectedUser = null;
                        document.getElementById('userSelector').value = '';
                    }
                } catch (error) {
                    console.error(error);
                    showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                }

                deleteBtn.disabled = false;
                deleteBtn.innerHTML = originalContent;
                delete deleteBtn.dataset.confirmDelete;
            } else {
                deleteBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?';
                deleteBtn.dataset.confirmDelete = 'true';

                setTimeout(() => {
                    deleteBtn.innerHTML = originalContent;
                    delete deleteBtn.dataset.confirmDelete;
                }, 3000);
            }
        });

        document.getElementById('userSelector').addEventListener('change', (e) => {
            selectedUser = e.target.value;

            if (selectedUser) {
                const transactions = allData.filter(item => item.type === 'transaction' && item.user_id === selectedUser);
                renderTransactionList(transactions);
                updateTransactionStats(transactions);

                document.getElementById('transactionStats').style.display = 'grid';
                document.getElementById('transactionContent').style.display = 'block';

                const today = new Date().toISOString().split('T')[0];
                document.getElementById('transactionDate').value = today;
                updateCategoryOptions('income');
            } else {
                document.getElementById('transactionStats').style.display = 'none';
                document.getElementById('transactionContent').style.display = 'none';
            }

            resetTransactionForm();
        });

        document.getElementById('newTransactionBtn').addEventListener('click', () => {
            resetTransactionForm();
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        });

        document.getElementById('transactionCancelBtn').addEventListener('click', () => {
            resetTransactionForm();
        });

        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.radio-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                option.classList.add('selected');
                option.querySelector('input').checked = true;

                const type = option.dataset.type;
                updateCategoryOptions(type);
                document.getElementById('category').value = '';
            });
        });

        document.getElementById('transactionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!currentUser) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            if (!selectedUser) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            const submitBtn = document.getElementById('transactionSubmitBtn');
            const originalContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const transactionType = document.querySelector('input[name="transactionType"]:checked').value;
            const amount = document.getElementById('amount').value;
            const category = document.getElementById('category').value;
            const date = document.getElementById('transactionDate').value;

            if (!amount || parseFloat(amount) <= 0) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalContent;
                return;
            }

            if (!category) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalContent;
                return;
            }

            const formData = {
                type: 'transaction',
                user_id: selectedUser,
                transaction_type: transactionType,
                amount: parseFloat(amount),
                category: category,
                description: document.getElementById('description').value.trim(),
                date: date,
                updatedAt: new Date().toISOString()
            };

            try {
                if (isTransactionEditMode && currentTransaction) {
                    const updatedTransaction = {
                        ...currentTransaction,
                        ...formData
                    };

                    const { __backendId, ...dataToSave } = updatedTransaction;

                    await updateDoc(doc(db, 'users', currentUser.uid, 'finance_data', __backendId), dataToSave);
                    showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    resetTransactionForm();

                } else {
                    if (allData.length >= 999) {
                        showToast('‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß', 'error');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalContent;
                        return;
                    }

                    const newTransaction = {
                        id: generateId(),
                        ...formData,
                        createdAt: new Date().toISOString()
                    };

                    await addDoc(collection(db, 'users', currentUser.uid, 'finance_data'), newTransaction);
                    showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    resetTransactionForm();
                }
            } catch (error) {
                console.error(error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            }

            submitBtn.disabled = false;
            submitBtn.innerHTML = originalContent;
        });

        document.getElementById('transactionDeleteBtn').addEventListener('click', async () => {
            if (!currentTransaction || !currentUser) return;

            const deleteBtn = document.getElementById('transactionDeleteBtn');
            const originalContent = deleteBtn.innerHTML;

            if (deleteBtn.dataset.confirmDelete === 'true') {
                deleteBtn.disabled = true;
                deleteBtn.innerHTML = '<span class="loading"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...';

                try {
                    await deleteDoc(doc(db, 'users', currentUser.uid, 'finance_data', currentTransaction.__backendId));

                    showToast('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    resetTransactionForm();
                } catch (error) {
                    console.error(error);
                    showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                }

                deleteBtn.disabled = false;
                deleteBtn.innerHTML = originalContent;
                delete deleteBtn.dataset.confirmDelete;
            } else {
                deleteBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?';
                deleteBtn.dataset.confirmDelete = 'true';

                setTimeout(() => {
                    deleteBtn.innerHTML = originalContent;
                    delete deleteBtn.dataset.confirmDelete;
                }, 3000);
            }
        });

        async function onConfigChange(config) {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
            document.body.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color} 0%, ${config.secondary_action_color || defaultConfig.secondary_action_color} 100%)`;

            document.getElementById('pageTitle').textContent = config.page_title || defaultConfig.page_title;
            document.getElementById('pageTitle').style.fontSize = `${baseSize * 2}px`;
            document.getElementById('pageTitle').style.color = config.primary_action_color || defaultConfig.primary_action_color;

            document.getElementById('welcomeMessage').textContent = config.welcome_message || defaultConfig.welcome_message;
            document.getElementById('welcomeMessage').style.fontSize = `${baseSize * 1.1}px`;
            document.getElementById('welcomeMessage').style.color = config.text_color || defaultConfig.text_color;

            document.getElementById('footerText').textContent = config.footer_text || defaultConfig.footer_text;
            document.getElementById('footerText').style.fontSize = `${baseSize * 0.9}px`;

            document.querySelectorAll('.card').forEach(card => {
                card.style.background = config.surface_color || defaultConfig.surface_color;
            });

            document.querySelectorAll('.card h2').forEach(h2 => {
                h2.style.color = config.primary_action_color || defaultConfig.primary_action_color;
                h2.style.fontSize = `${baseSize * 1.5}px`;
            });

            document.querySelectorAll('.btn').forEach(btn => {
                if (!btn.classList.contains('btn-secondary') && !btn.classList.contains('btn-danger') && !btn.classList.contains('btn-success')) {
                    btn.style.background = `linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color} 0%, ${config.secondary_action_color || defaultConfig.secondary_action_color} 100%)`;
                }
                btn.style.fontSize = `${baseSize}px`;
            });

            document.querySelectorAll('label, input, textarea, select').forEach(el => {
                el.style.fontSize = `${baseSize}px`;
                el.style.color = config.text_color || defaultConfig.text_color;
            });
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                config.background_color = value;
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        },
                        {
                            get: () => config.surface_color || defaultConfig.surface_color,
                            set: (value) => {
                                config.surface_color = value;
                                window.elementSdk.setConfig({ surface_color: value });
                            }
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                config.text_color = value;
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        },
                        {
                            get: () => config.primary_action_color || defaultConfig.primary_action_color,
                            set: (value) => {
                                config.primary_action_color = value;
                                window.elementSdk.setConfig({ primary_action_color: value });
                            }
                        },
                        {
                            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                            set: (value) => {
                                config.secondary_action_color = value;
                                window.elementSdk.setConfig({ secondary_action_color: value });
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: {
                        get: () => config.font_family || defaultConfig.font_family,
                        set: (value) => {
                            config.font_family = value;
                            window.elementSdk.setConfig({ font_family: value });
                        }
                    },
                    fontSizeable: {
                        get: () => config.font_size || defaultConfig.font_size,
                        set: (value) => {
                            config.font_size = value;
                            window.elementSdk.setConfig({ font_size: value });
                        }
                    }
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["page_title", config.page_title || defaultConfig.page_title],
                    ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
                    ["footer_text", config.footer_text || defaultConfig.footer_text]
                ])
            });
        }

        async function initAuth() {
            try {
                // FIX: ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ __initial_auth_token ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ config ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö
                // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ signInAnonymously ‡πÅ‡∏ó‡∏ô
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Auth Error:", error);
                let msg = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message;
                if (error.code === 'auth/admin-restricted-operation' || error.code === 'auth/configuration-not-found') {
                    msg = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Anonymous Auth ‡πÉ‡∏ô Firebase Console ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö';
                }
                showToast(msg, 'error');
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                console.log("User authenticated:", user.uid);
                setupRealtimeListener(user);
            } else {
                currentUser = null;
                if (unsubscribeSnapshot) unsubscribeSnapshot();
            }
        });

        // Start Auth
        initAuth();

        // Initialize Date
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('transactionDate').value = today;
        updateCategoryOptions('income');
    </script>
</body>

</html>